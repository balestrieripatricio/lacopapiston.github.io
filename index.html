<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COPA PIST√ìN - EDICI√ìN DEFINITIVA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            font-style: italic;
        }

        /* Tarjetas de Torneos */
        .tournament-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tournament-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .tournament-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .tournament-card.liga {
            border-color: #3399ff;
            background: linear-gradient(135deg, #66ccff, #3399ff);
        }

        .tournament-card.pakistani {
            border-color: #33cc66;
            background: linear-gradient(135deg, #66ff99, #33cc66);
        }

        .tournament-card.ets {
            border-color: #9933cc;
            background: linear-gradient(135deg, #cc99ff, #9933cc);
        }

        .tournament-card.supercopa {
            border-color: #ffcc00;
            background: linear-gradient(135deg, #fff066, #ffcc33);
        }

        .tournament-card.hall-fama {
            border-color: #FFD700;
            background: linear-gradient(135deg, #FFF8DC, #FFD700);
        }

        .tournament-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .tournament-card h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #333;
        }

        .tournament-card p {
            color: #666;
            font-size: 0.9em;
        }

        /* Modales */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .role-btn {
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pato-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: black;
        }

        .femboy-btn {
            background: linear-gradient(135deg, #FFB6C1, #FF69B4);
            color: white;
        }

        .role-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        /* Contenido del Torneo */
        .tournament-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #5a6268;
            transform: translateX(-5px);
        }

        .reset-all-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 1em;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .reset-all-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        /* Tablas */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        .standings-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .standings-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
        }

        .standings-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .standings-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .standings-table tr:hover {
            background: #e3f2fd;
        }

        /* Partidos */
        .match-day {
            margin: 20px 0;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }

        .match-day-header {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .matches-container {
            padding: 15px;
            background: #f8f9fa;
        }

        .match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .match:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .match.played {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .teams {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .vs {
            color: #666;
            font-weight: bold;
            margin: 0 10px;
        }

        .result-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-weight: bold;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-generate {
            background: #28a745;
            color: white;
        }

        .btn-generate:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .btn-simulate {
            background: #17a2b8;
            color: white;
        }

        .btn-simulate:hover {
            background: #138496;
            transform: scale(1.05);
        }

        .btn-advance {
            background: #6f42c1;
            color: white;
            padding: 10px 20px;
            margin: 10px 0;
        }

        .btn-advance:hover {
            background: #5a2d91;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            font-weight: bold;
            font-size: 1.1em;
            min-width: 60px;
            text-align: center;
        }

        .simulated {
            color: #17a2b8;
            font-style: italic;
        }

        /* Gr√°fico de Evoluci√≥n */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3em;
            font-weight: bold;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8em;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Hall de la Fama */
        .hall-fama-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .temporada-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .temporada-btn {
            padding: 8px 16px;
            border: 2px solid #6c757d;
            background: white;
            color: #6c757d;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .temporada-btn.active {
            background: #6c757d;
            color: white;
        }

        .temporada-btn:hover {
            transform: scale(1.05);
        }

        .campeones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .campeon-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #28a745;
        }

        .campeon-card.liga {
            border-left-color: #3399ff;
        }

        .campeon-card.pakistani {
            border-left-color: #33cc66;
        }

        .campeon-card.ets {
            border-left-color: #9933cc;
        }

        .campeon-card.supercopa {
            border-left-color: #ffcc00;
        }

        .campeon-titulo {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .campeon-equipo {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .tournament-grid {
                grid-template-columns: 1fr;
            }

            .match {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .teams {
                flex-direction: column;
                gap: 5px;
            }

            .result-inputs {
                justify-content: center;
            }

            .chart-legend {
                font-size: 0.7em;
            }

            .campeones-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Efectos especiales */
        @keyframes goalAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #dc3545; }
            100% { transform: scale(1); }
        }

        .goal-animation {
            animation: goalAnimation 0.5s ease-in-out;
        }

        .champion-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: black;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin: 20px 0;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(255,215,0,0.3);
        }

        .admin-badge {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .femboy-badge {
            background: #17a2b8;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        /* Loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-message {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .status-saving {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-saved {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Pantalla de Selecci√≥n de Rol -->
        <div id="roleSelection" class="modal" style="display: block;">
            <div class="modal-content">
                <div class="header">
                    <h1>üèÜ COPA PIST√ìN üèÜ</h1>
                    <p class="subtitle">"tuvimos que estudiar programaci√≥n para que RedBull no se robe todas las copas"</p>
                </div>
                
                <h2 style="margin: 20px 0; color: #333;">BIENVENIDOS A LA COPA PIST√ìN</h2>
                
                <button class="role-btn pato-btn" onclick="selectRole('pato')">
                    üêê PATO (GOAT) - Modo Admin
                </button>
                <p style="color: #666; margin-bottom: 20px;">Carg√°s resultados reales que todos ven</p>
                
                <button class="role-btn femboy-btn" onclick="selectRole('femboy')">
                    üéÄ FEMBOY - Modo Simulaci√≥n
                </button>
                <p style="color: #666;">Simul√°s partidos (solo vos los ves)</p>
            </div>
        </div>

        <!-- Pantalla Principal -->
        <div id="mainScreen" style="display: none;">
            <div class="header">
                <h1>COPA PIST√ìN</h1>
                <p class="subtitle">"tuvimos que estudiar programaci√≥n para que RedBull no se robe todas las copas"</p>
                <div id="roleIndicator" style="margin-top: 10px;"></div>
                <div style="margin-top: 15px;">
                    <button class="back-btn" onclick="hideTournament()">üîô Volver al Men√∫</button>
                    <button class="reset-all-btn" onclick="resetAllTournaments()" id="resetAllBtn" style="display: none;">üîÑ Reiniciar Todos los Torneos</button>
                </div>
                <div id="statusMessage" class="status-message" style="display: none;"></div>
            </div>

            <!-- Grid de Torneos -->
            <div class="tournament-grid">
                <div class="tournament-card liga" onclick="showTournament('liga')">
                    <div class="tournament-icon">‚öΩ</div>
                    <h3>LIGA</h3>
                    <p>Torneo de todos contra todos</p>
                </div>
                
                <div class="tournament-card pakistani" onclick="showTournament('pakistani')">
                    <div class="tournament-icon">üèÖ</div>
                    <h3>COPA PAKISTANI</h3>
                    <p>Eliminaci√≥n directa</p>
                </div>
                
                <div class="tournament-card ets" onclick="showTournament('ets')">
                    <div class="tournament-icon">üåü</div>
                    <h3>COPA ETS</h3>
                    <p>Ida y vuelta</p>
                </div>
                
                <div class="tournament-card supercopa" onclick="showTournament('supercopa')">
                    <div class="tournament-icon">üî•</div>
                    <h3>SUPERCOPA</h3>
                    <p>Campe√≥n vs Campe√≥n</p>
                </div>

                <div class="tournament-card hall-fama" onclick="showTournament('hall-fama')">
                    <div class="tournament-icon">üèõÔ∏è</div>
                    <h3>HALL DE LA FAMA</h3>
                    <p>Campeones hist√≥ricos</p>
                </div>
            </div>

            <!-- Contenido de Torneos -->
            <div id="tournamentContent" class="tournament-content"></div>
        </div>
    </div>

    <script>
        // Configuraci√≥n
        const JSONBIN_ID = '67bd2f56e41b4d34e40f1a5e';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`;
        const JSONBIN_HEADERS = {
            'X-Master-Key': '$2a$10$Qd2Z6ZQ8Qd2Z6ZQ8Qd2Z6ZQ8Qd2Z6ZQ8Qd2Z6ZQ8Qd2Z6ZQ8Qd2Z6ZQ8'
        };

        // Paleta de colores EXACTA como la pediste
        const COLORES_EQUIPOS = {
            "ATHLETICO": "#800000",      // bordo/granate
            "JORGE": "#FF69B4",          // rosa
            "ILOVECP": "#FF8C00",        // naranja
            "JOSHUA": "#FFD700",         // amarillo
            "PORONGASURIO": "#40E0D0",   // turquesa
            "RHINO": "#DC143C",          // rojo
            "SOMBRERO DE PAJA": "#000000", // negro
            "EMI": "#B22222",            // rojo fuerte
            "MDV": "#8A2BE2",            // violeta
            "MANTECA": "#87CEEB",        // celeste claro
            "RD": "#00BFFF",             // celeste
            "USOCY": "#32CD32",          // verde
            "COCODRILOS": "#DA70D6",     // violeta-rosa
            "AVENA": "#D2B48C",          // marr√≥n claro
            "RBS": "#FFFFFF",            // blanco (con borde)
            "COSQUIN": "#696969",        // gris oscuro
            "RAJASPANDAV": "#FF4500",    // naranja oscuro
            "PUNGASAURIO": "#D3D3D3"     // gris clarito
        };

        // Abreviaturas de 3 letras para el gr√°fico
        const ABREVIATURAS_EQUIPOS = {
            "ATHLETICO": "ATH",
            "AVENA": "AVE",
            "SOMBRERO DE PAJA": "SOM",
            "COSQUIN": "COS",
            "MDV": "MDV",
            "RBS": "RBS",
            "RD": "RD",
            "COCODRILOS": "COC",
            "USOCY": "USO",
            "MANTECA": "MAN",
            "RHINO": "RHI",
            "EMI": "EMI",
            "RAJASPANDAV": "RAJ",
            "PORONGASURIO": "POR",
            "PUNGASAURIO": "PUN",
            "ILOVECP": "ILO",
            "JORGE": "JOR",
            "JOSHUA": "JOS"
        };

        // Datos globales
        let appData = {
            userRole: '',
            liga: {
                equipos: ["ATHLETICO","AVENA","SOMBRERO DE PAJA","COSQUIN","MDV","RBS","RD","COCODRILOS",
                         "USOCY","MANTECA","RHINO","EMI","RAJASPANDAV","PORONGASURIO","PUNGASAURIO",
                         "ILOVECP","JORGE","JOSHUA"],
                tabla: {},
                partidosJugados: {},
                fixture: [],
                campeon: null,
                historialPosiciones: []
            },
            pakistani: {
                fases: { octavos: [], cuartos: [], semis: [], final: [] },
                campeon: null
            },
            ets: {
                fases: { cuartos: [], semis: [], final: [] },
                campeon: null
            },
            supercopa: {
                partido: null,
                campeon: null
            },
            hallFama: {
                temporadas: {
                    1: { liga: "ATHLETICO", pakistani: "MDV", supercopa: "ATHLETICO" },
                    2: { liga: "ATHLETICO", pakistani: "AVENA", supercopa: "ATHLETICO" },
                    3: { liga: "USOCY", pakistani: "RBS", supercopa: "USOCY" },
                    4: { liga: "USOCY", pakistani: "ILOVECP", supercopa: "ILOVECP" },
                    5: { liga: "USOCY", pakistani: "COSQUIN", ets: "ATHLETICO", supercopa: "COSQUIN" },
                    6: { liga: null, pakistani: null, ets: null, supercopa: null }
                }
            },
            simulaciones: {
                liga: {},
                pakistani: {},
                ets: {},
                supercopa: {}
            }
        };

        // FECHAS 1 Y 2 FIJAS (EXACTAMENTE como las mandaste)
        const FECHAS_FIJAS = {
            0: [ // Fecha 1
                { local: "ATHLETICO", visitante: "JOSHUA" },
                { local: "AVENA", visitante: "JORGE" },
                { local: "SOMBRERO DE PAJA", visitante: "ILOVECP" },
                { local: "COSQUIN", visitante: "PUNGASAURIO" },
                { local: "MDV", visitante: "PORONGASURIO" },
                { local: "RBS", visitante: "RAJASPANDAV" },
                { local: "RD", visitante: "EMI" },
                { local: "COCODRILOS", visitante: "RHINO" },
                { local: "USOCY", visitante: "MANTECA" }
            ],
            1: [ // Fecha 2
                { local: "JORGE", visitante: "ATHLETICO" },
                { local: "ILOVECP", visitante: "JOSHUA" },
                { local: "PUNGASAURIO", visitante: "AVENA" },
                { local: "PORONGASURIO", visitante: "SOMBRERO DE PAJA" },
                { local: "RAJASPANDAV", visitante: "COSQUIN" },
                { local: "EMI", visitante: "MDV" },
                { local: "RHINO", visitante: "RBS" },
                { local: "MANTECA", visitante: "RD" },
                { local: "USOCY", visitante: "COCODRILOS" }
            ]
        };

        // Variables globales para ETS
        let etsFaseActual = 'cuartos';
        let etsTipoPartido = 'ida';
        let temporadaActualHallFama = 6;

        // Sonido de gol
        function playGoalSound() {
            const audio = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==");
            audio.volume = 0.3;
            audio.play().catch(() => {});
        }

        // Sistema de Roles
        function selectRole(role) {
            if (role === 'pato') {
                const password = prompt("üêê PATO - Ingres√° la clave del admin:");
                if (password === "PampaATH") {
                    appData.userRole = 'pato';
                    document.getElementById('roleSelection').style.display = 'none';
                    document.getElementById('mainScreen').style.display = 'block';
                    document.getElementById('resetAllBtn').style.display = 'inline-block';
                    showRoleIndicator();
                    loadData();
                } else {
                    alert("‚ùå Clave incorrecta");
                }
            } else {
                appData.userRole = 'femboy';
                document.getElementById('roleSelection').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                document.getElementById('resetAllBtn').style.display = 'none';
                showRoleIndicator();
                loadData();
            }
        }

        function showRoleIndicator() {
            const indicator = document.getElementById('roleIndicator');
            if (appData.userRole === 'pato') {
                indicator.innerHTML = '<span class="admin-badge">üêê MODO ADMIN - Todos ven tus cambios</span>';
            } else {
                indicator.innerHTML = '<span class="femboy-badge">üéÄ MODO SIMULACI√ìN - Solo vos ves tus cambios</span>';
            }
        }

        // Sistema de Datos - JSONBIN
        async function loadData() {
            showStatus('Cargando datos...', 'saving');
            try {
                const response = await fetch(JSONBIN_URL, { headers: JSONBIN_HEADERS });
                const data = await response.json();
                const savedData = data.record;
                
                if (savedData) {
                    const simulacionesTemp = { ...appData.simulaciones };
                    Object.assign(appData, savedData);
                    appData.simulaciones = simulacionesTemp;
                    showStatus('Datos cargados ‚úÖ', 'saved');
                } else {
                    initializeData();
                    showStatus('Datos inicializados ‚úÖ', 'saved');
                }
            } catch (error) {
                console.log('Inicializando datos nuevos');
                initializeData();
                showStatus('Datos inicializados ‚úÖ', 'saved');
            }
        }

        async function saveData() {
            if (appData.userRole === 'pato') {
                showStatus('Guardando...', 'saving');
                try {
                    const dataToSave = { ...appData };
                    delete dataToSave.simulaciones;
                    
                    await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            ...JSONBIN_HEADERS
                        },
                        body: JSON.stringify(dataToSave)
                    });
                    showStatus('Datos guardados ‚úÖ', 'saved');
                } catch (error) {
                    console.log('Error guardando en JSONBIN');
                    showStatus('Error guardando ‚ùå', 'error');
                }
            }
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';
            
            if (type === 'saved') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            }
        }

        function initializeData() {
            // Inicializar Liga
            appData.liga.tabla = {};
            appData.liga.equipos.forEach(equipo => {
                appData.liga.tabla[equipo] = { PJ: 0, G: 0, E: 0, P: 0, GF: 0, GC: 0, DG: 0, Pts: 0 };
            });

            // Generar fixture con fechas fijas + resto autom√°tico SIN REPETICIONES
            if (appData.liga.fixture.length === 0) {
                appData.liga.fixture = generateFixtureWithoutRepetitions();
            }

            // Inicializar historial de posiciones
            if (appData.liga.historialPosiciones.length === 0) {
                actualizarHistorialPosiciones();
            }

            // Inicializar copas si no existen
            if (appData.pakistani.fases.octavos.length === 0) {
                initializePakistani();
            }

            if (appData.ets.fases.cuartos.length === 0) {
                initializeETS();
            }

            saveData();
        }

        // Generar fixture SIN REPETICIONES de fechas 1-2
        function generateFixtureWithoutRepetitions() {
            const fixture = [];
            const partidosJugados = new Set();
            
            // Agregar fechas fijas 1 y 2
            fixture.push([...FECHAS_FIJAS[0]]);
            fixture.push([...FECHAS_FIJAS[1]]);
            
            // Agregar partidos fijos al set de jugados
            FECHAS_FIJAS[0].forEach(p => partidosJugados.add(`${p.local}-${p.visitante}`));
            FECHAS_FIJAS[1].forEach(p => partidosJugados.add(`${p.local}-${p.visitante}`));

            // Generar resto del fixture evitando repeticiones
            const teams = [...appData.liga.equipos];
            const totalRounds = teams.length - 1;
            
            for (let round = 2; round < totalRounds; round++) {
                const roundMatches = [];
                const usedTeams = new Set();
                
                for (let i = 0; i < teams.length; i++) {
                    for (let j = i + 1; j < teams.length; j++) {
                        const matchKey1 = `${teams[i]}-${teams[j]}`;
                        const matchKey2 = `${teams[j]}-${teams[i]}`;
                        
                        if (!usedTeams.has(teams[i]) && !usedTeams.has(teams[j]) &&
                            !partidosJugados.has(matchKey1) && !partidosJugados.has(matchKey2)) {
                            
                            roundMatches.push({
                                local: teams[i],
                                visitante: teams[j],
                                jugado: false
                            });
                            partidosJugados.add(matchKey1);
                            usedTeams.add(teams[i]);
                            usedTeams.add(teams[j]);
                            break;
                        }
                    }
                }
                fixture.push(roundMatches);
            }
            
            return fixture;
        }

        // Navegaci√≥n de Torneos
        function showTournament(torneo) {
            const content = document.getElementById('tournamentContent');
            content.style.display = 'block';
            
            switch(torneo) {
                case 'liga':
                    showLiga();
                    break;
                case 'pakistani':
                    showPakistani();
                    break;
                case 'ets':
                    showETS();
                    break;
                case 'supercopa':
                    showSupercopa();
                    break;
                case 'hall-fama':
                    showHallFama();
                    break;
            }
        }

        function hideTournament() {
            document.getElementById('tournamentContent').style.display = 'none';
        }

        // VISTA LIGA
        function showLiga() {
            const content = document.getElementById('tournamentContent');
            content.innerHTML = `
                <button class="back-btn" onclick="hideTournament()">üîô Volver al Men√∫</button>
                <h2>‚öΩ LIGA</h2>
                
                ${appData.liga.campeon ? `
                    <div class="champion-badge">
                        üèÜ CAMPE√ìN: ${appData.liga.campeon} üèÜ
                    </div>
                ` : ''}
                
                <div class="table-container">
                    <h3>Tabla de Posiciones</h3>
                    ${generateStandingsTable()}
                </div>

                <div class="chart-container">
                    <div class="chart-title">üìà Evoluci√≥n de Posiciones</div>
                    <canvas id="evolutionChart" width="800" height="400"></canvas>
                    <div class="chart-legend" id="chartLegend"></div>
                </div>
                
                <div class="fixture-container">
                    <h3>Fixture</h3>
                    ${generateFixtureView()}
                </div>
            `;

            // Generar gr√°fico despu√©s de que se renderice el HTML
            setTimeout(() => {
                generarGraficoEvolucion();
            }, 100);

            // Abrir primeras fechas por defecto
            setTimeout(() => {
                const rounds = document.querySelectorAll('.match-day-header');
                if (rounds.length > 0) {
                    rounds[0].click(); // Fecha 1
                    if (rounds.length > 1) rounds[1].click(); // Fecha 2
                }
            }, 200);
        }

        function generarGraficoEvolucion() {
            const canvas = document.getElementById('evolutionChart');
            const ctx = canvas.getContext('2d');
            const legend = document.getElementById('chartLegend');
            
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Configuraci√≥n del gr√°fico
            const margin = { top: 40, right: 40, bottom: 60, left: 60 };
            const width = canvas.width - margin.left - margin.right;
            const height = canvas.height - margin.top - margin.bottom;
            
            // Escalas
            const maxFecha = Math.max(appData.liga.historialPosiciones.length, 1);
            const xScale = width / Math.max(maxFecha - 1, 1);
            const yScale = height / 17; // 18 posiciones (1-18)
            
            // Dibujar ejes
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            
            // Eje Y (posiciones)
            for (let i = 1; i <= 18; i++) {
                const y = margin.top + (i - 1) * yScale;
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(margin.left + width, y);
                ctx.stroke();
                
                // Etiquetas de posici√≥n
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.fillText(i + '¬∞', margin.left - 25, y + 4);
            }
            
            // Eje X (fechas)
            for (let i = 0; i < maxFecha; i++) {
                const x = margin.left + i * xScale;
                ctx.beginPath();
                ctx.moveTo(x, margin.top);
                ctx.lineTo(x, margin.top + height);
                ctx.stroke();
                
                // Etiquetas de fecha
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.fillText('F' + (i + 1), x - 10, margin.top + height + 20);
            }
            
            // Dibujar l√≠neas de equipos
            let legendHTML = '';
            appData.liga.equipos.forEach((equipo, equipoIndex) => {
                const color = COLORES_EQUIPOS[equipo];
                const abreviatura = ABREVIATURAS_EQUIPOS[equipo];
                if (!color) return;
                
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                let puntos = [];
                for (let fecha = 0; fecha < appData.liga.historialPosiciones.length; fecha++) {
                    const posiciones = appData.liga.historialPosiciones[fecha];
                    const posicion = posiciones.findIndex(p => p.equipo === equipo) + 1;
                    
                    if (posicion > 0) {
                        const x = margin.left + fecha * xScale;
                        const y = margin.top + (posicion - 1) * yScale;
                        puntos.push({ x, y });
                        
                        if (fecha === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }

                        // Dibujar etiqueta de 3 letras en el primer punto
                        if (fecha === 0) {
                            ctx.fillStyle = color;
                            ctx.font = '10px Arial';
                            ctx.fillText(abreviatura, x - 15, y - 5);
                        }
                    }
                }
                
                ctx.stroke();
                
                // Dibujar puntos
                ctx.fillStyle = color;
                puntos.forEach(punto => {
                    ctx.beginPath();
                    ctx.arc(punto.x, punto.y, 4, 0, 2 * Math.PI);
                    ctx.fill();
                });
                
                // Agregar a leyenda
                const borderStyle = equipo === 'RBS' ? 'style="border: 1px solid #ccc;"' : '';
                legendHTML += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${color}; ${borderStyle}"></div>
                        ${equipo}
                    </div>
                `;
            });
            
            legend.innerHTML = legendHTML;
            
            // T√≠tulo del gr√°fico
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('Evoluci√≥n de Posiciones por Fecha', margin.left + width/2 - 100, margin.top - 10);
        }

        function actualizarHistorialPosiciones() {
            // Calcular posiciones actuales
            const equiposOrdenados = [...appData.liga.equipos].sort((a, b) => {
                const statsA = appData.liga.tabla[a] || { Pts: 0, DG: 0, GF: 0 };
                const statsB = appData.liga.tabla[b] || { Pts: 0, DG: 0, GF: 0 };
                
                if (statsB.Pts !== statsA.Pts) return statsB.Pts - statsA.Pts;
                if (statsB.DG !== statsA.DG) return statsB.DG - statsA.DG;
                return statsB.GF - statsA.GF;
            });
            
            const posicionesActuales = equiposOrdenados.map(equipo => ({ equipo }));
            
            // Agregar al historial
            appData.liga.historialPosiciones.push(posicionesActuales);
        }

        function generateStandingsTable() {
            // Usar tabla simulada si es femboy y existe, sino tabla real
            const tablaAMostrar = (appData.userRole === 'femboy' && Object.keys(appData.simulaciones.liga).length > 0) 
                ? appData.simulaciones.liga 
                : appData.liga.tabla;

            const equiposOrdenados = [...appData.liga.equipos].sort((a, b) => {
                const statsA = tablaAMostrar[a] || { Pts: 0, DG: 0, GF: 0 };
                const statsB = tablaAMostrar[b] || { Pts: 0, DG: 0, GF: 0 };
                
                if (statsB.Pts !== statsA.Pts) return statsB.Pts - statsA.Pts;
                if (statsB.DG !== statsA.DG) return statsB.DG - statsA.DG;
                return statsB.GF - statsA.GF;
            });

            let html = `
                <table class="standings-table">
                    <tr>
                        <th>Pos</th>
                        <th>Equipo</th>
                        <th>PJ</th>
                        <th>G</th>
                        <th>E</th>
                        <th>P</th>
                        <th>GF</th>
                        <th>GC</th>
                        <th>DG</th>
                        <th>Pts</th>
                    </tr>
            `;

            equiposOrdenados.forEach((equipo, index) => {
                const stats = tablaAMostrar[equipo] || { PJ: 0, G: 0, E: 0, P: 0, GF: 0, GC: 0, DG: 0, Pts: 0 };
                const color = COLORES_EQUIPOS[equipo] || '#666';
                const textColor = equipo === 'RBS' ? 'style="color: #333; background-color: #f8f9fa; border: 1px solid #ddd; padding: 2px 5px; border-radius: 3px;"' : '';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong ${textColor}>${equipo}</strong></td>
                        <td>${stats.PJ}</td>
                        <td>${stats.G}</td>
                        <td>${stats.E}</td>
                        <td>${stats.P}</td>
                        <td>${stats.GF}</td>
                        <td>${stats.GC}</td>
                        <td>${stats.DG}</td>
                        <td><strong>${stats.Pts}</strong></td>
                    </tr>
                `;
            });

            html += '</table>';
            
            // Indicador de qu√© tabla se est√° mostrando
            if (appData.userRole === 'femboy' && Object.keys(appData.simulaciones.liga).length > 0) {
                html += '<p style="text-align: center; color: #17a2b8; margin-top: 10px;">üîÆ Tabla con simulaciones temporales</p>';
            }
            
            return html;
        }

        function generateFixtureView() {
            let html = '';
            
            appData.liga.fixture.forEach((fecha, indexFecha) => {
                const fechaNum = indexFecha + 1;
                html += `
                    <div class="match-day">
                        <div class="match-day-header" onclick="toggleRound(${indexFecha})">
                            <span>Fecha ${fechaNum}</span>
                            <span>‚ñº</span>
                        </div>
                        <div class="matches-container" id="round-${indexFecha}" style="display: ${fechaNum <= 2 ? 'block' : 'none'}">
                            ${generateMatchesForRound(fecha, indexFecha)}
                        </div>
                    </div>
                `;
            });
            
            return html;
        }

        function toggleRound(roundIndex) {
            const roundDiv = document.getElementById(`round-${roundIndex}`);
            roundDiv.style.display = roundDiv.style.display === 'none' ? 'block' : 'none';
        }

        function generateMatchesForRound(partidos, numFecha) {
            let html = '';
            
            partidos.forEach((partido, indexPartido) => {
                const key = `${partido.local}-${partido.visitante}`;
                const resultadoReal = appData.liga.partidosJugados[key];
                const jugadoReal = !!resultadoReal;
                const esFemboy = appData.userRole === 'femboy';
                const esFechaInicial = numFecha < 2;
                
                let resultadoHTML = '';
                let botonHTML = '';
                
                // SIEMPRE mostrar resultado si existe
                if (jugadoReal) {
                    resultadoHTML = `<span class="result" style="color: #28a745;">${resultadoReal.local}-${resultadoReal.visitante}</span>`;
                } else if (appData.simulaciones.liga[key]) {
                    const sim = appData.simulaciones.liga[key];
                    resultadoHTML = `<span class="result simulated">${sim.local}-${sim.visitante}</span>`;
                } else {
                    resultadoHTML = '<span class="result" style="color: #999;">-</span>';
                }

                if (esFemboy) {
                    if (!jugadoReal) {
                        botonHTML = `<button class="btn btn-simulate" onclick="simularPartidoLiga('${partido.local}', '${partido.visitante}', ${numFecha})">Simular</button>`;
                    } else {
                        botonHTML = `<button class="btn" disabled>Jugado</button>`;
                    }
                } else {
                    // Modo Admin
                    if (esFechaInicial) {
                        const resultadoActual = resultadoReal || {local: '', visitante: ''};
                        botonHTML = `
                            <div class="result-inputs">
                                <input type="number" class="result-input" id="local-${key}" value="${resultadoActual.local}" min="0">
                                <span> - </span>
                                <input type="number" class="result-input" id="visitante-${key}" value="${resultadoActual.visitante}" min="0">
                                <button class="btn btn-generate" onclick="guardarResultadoManual('${partido.local}', '${partido.visitante}', ${numFecha})">
                                    ${jugadoReal ? 'Actualizar' : 'Guardar'}
                                </button>
                                <button class="btn btn-simulate" onclick="generarResultadoLiga('${partido.local}', '${partido.visitante}', ${numFecha})">
                                    Generar
                                </button>
                            </div>
                        `;
                    } else {
                        if (!jugadoReal) {
                            botonHTML = `<button class="btn btn-generate" onclick="generarResultadoLiga('${partido.local}', '${partido.visitante}', ${numFecha})">Generar</button>`;
                        } else {
                            botonHTML = `<button class="btn" disabled>Jugado</button>`;
                        }
                    }
                }

                html += `
                    <div class="match ${jugadoReal ? 'played' : ''}">
                        <div class="teams">
                            <strong>${partido.local}</strong>
                            <span class="vs">VS</span>
                            <strong>${partido.visitante}</strong>
                        </div>
                        ${resultadoHTML}
                        ${botonHTML}
                    </div>
                `;
            });
            
            return html;
        }

        // Funciones de resultados - LIGA
        async function guardarResultadoManual(local, visitante, numFecha) {
            const key = `${local}-${visitante}`;
            const inputLocal = document.getElementById(`local-${key}`);
            const inputVisitante = document.getElementById(`visitante-${key}`);
            
            const resultado = {
                local: parseInt(inputLocal.value) || 0,
                visitante: parseInt(inputVisitante.value) || 0
            };

            if (appData.userRole === 'pato') {
                appData.liga.partidosJugados[key] = resultado;
                actualizarTablaLiga(local, visitante, resultado);
                appData.liga.fixture[numFecha].forEach(p => {
                    if (p.local === local && p.visitante === visitante) {
                        p.jugado = true;
                    }
                });
                await saveData();
                playGoalSound();
            }

            // Actualizar vista sin recargar todo
            updateSingleMatch(local, visitante, resultado, numFecha);
        }

        async function generarResultadoLiga(local, visitante, numFecha) {
            const resultado = generarResultadoAleatorio();
            
            if (appData.userRole === 'pato') {
                const key = `${local}-${visitante}`;
                appData.liga.partidosJugados[key] = resultado;
                actualizarTablaLiga(local, visitante, resultado);
                appData.liga.fixture[numFecha].forEach(p => {
                    if (p.local === local && p.visitante === visitante) {
                        p.jugado = true;
                    }
                });
                await saveData();
                playGoalSound();
            } else {
                const key = `${local}-${visitante}`;
                appData.simulaciones.liga[key] = resultado;
                actualizarTablaSimulada(local, visitante, resultado);
            }

            // Actualizar vista sin recargar todo
            updateSingleMatch(local, visitante, resultado, numFecha);
        }

        function simularPartidoLiga(local, visitante, numFecha) {
            const resultado = generarResultadoAleatorio();
            const key = `${local}-${visitante}`;
            appData.simulaciones.liga[key] = resultado;
            actualizarTablaSimulada(local, visitante, resultado);
            playGoalSound();
            updateSingleMatch(local, visitante, resultado, numFecha);
        }

        function updateSingleMatch(local, visitante, resultado, numFecha) {
            // Actualizar solo el partido espec√≠fico sin recargar todo
            const key = `${local}-${visitante}`;
            const partidos = document.querySelectorAll('.match');
            
            partidos.forEach(partido => {
                const teams = partido.querySelector('.teams').textContent;
                if (teams.includes(local) && teams.includes(visitante)) {
                    const resultSpan = partido.querySelector('.result');
                    const buttons = partido.querySelectorAll('button');
                    
                    if (resultSpan) {
                        resultSpan.textContent = `${resultado.local}-${resultado.visitante}`;
                        if (appData.userRole === 'pato') {
                            resultSpan.style.color = '#28a745';
                        } else {
                            resultSpan.className = 'result simulated';
                        }
                    }
                    
                    // Deshabilitar botones si es admin y resultado real
                    if (appData.userRole === 'pato') {
                        buttons.forEach(btn => {
                            if (!btn.disabled && btn.textContent !== 'Guardar' && btn.textContent !== 'Actualizar') {
                                btn.disabled = true;
                                btn.textContent = 'Jugado';
                            }
                        });
                        partido.classList.add('played');
                    }
                }
            });
            
            // Actualizar tabla y gr√°fico
            const oldTable = document.querySelector('.standings-table');
            if (oldTable) {
                oldTable.outerHTML = generateStandingsTable();
            }
            
            // Actualizar historial y gr√°fico si es admin
            if (appData.userRole === 'pato') {
                actualizarHistorialPosiciones();
                setTimeout(() => {
                    generarGraficoEvolucion();
                }, 100);
            }
        }

        function generarResultadoAleatorio() {
            const golesLocal = Math.floor(Math.random() * 5);
            const golesVisitante = Math.floor(Math.random() * 4);
            return { local: golesLocal, visitante: golesVisitante };
        }

        function actualizarTablaLiga(local, visitante, resultado) {
            const statsLocal = appData.liga.tabla[local];
            const statsVisitante = appData.liga.tabla[visitante];

            // Reiniciar si no existen
            if (!statsLocal.PJ) statsLocal.PJ = 0;
            if (!statsVisitante.PJ) statsVisitante.PJ = 0;

            statsLocal.PJ++; statsVisitante.PJ++;
            statsLocal.GF += resultado.local; statsLocal.GC += resultado.visitante;
            statsVisitante.GF += resultado.visitante; statsVisitante.GC += resultado.local;
            statsLocal.DG = statsLocal.GF - statsLocal.GC;
            statsVisitante.DG = statsVisitante.GF - statsVisitante.GC;

            if (resultado.local > resultado.visitante) {
                statsLocal.G++; statsVisitante.P++;
                statsLocal.Pts += 3;
            } else if (resultado.local < resultado.visitante) {
                statsVisitante.G++; statsLocal.P++;
                statsVisitante.Pts += 3;
            } else {
                statsLocal.E++; statsVisitante.E++;
                statsLocal.Pts += 1; statsVisitante.Pts += 1;
            }

            checkCampeonLiga();
        }

        function actualizarTablaSimulada(local, visitante, resultado) {
            if (!appData.simulaciones.liga[local]) {
                appData.simulaciones.liga[local] = { ...appData.liga.tabla[local] };
            }
            if (!appData.simulaciones.liga[visitante]) {
                appData.simulaciones.liga[visitante] = { ...appData.liga.tabla[visitante] };
            }

            const statsLocal = appData.simulaciones.liga[local];
            const statsVisitante = appData.simulaciones.liga[visitante];

            if (!statsLocal.PJ) statsLocal.PJ = 0;
            if (!statsVisitante.PJ) statsVisitante.PJ = 0;

            statsLocal.PJ++; statsVisitante.PJ++;
            statsLocal.GF += resultado.local; statsLocal.GC += resultado.visitante;
            statsVisitante.GF += resultado.visitante; statsVisitante.GC += resultado.local;
            statsLocal.DG = statsLocal.GF - statsLocal.GC;
            statsVisitante.DG = statsVisitante.GF - statsVisitante.GC;

            if (resultado.local > resultado.visitante) {
                statsLocal.G++; statsVisitante.P++;
                statsLocal.Pts += 3;
            } else if (resultado.local < resultado.visitante) {
                statsVisitante.G++; statsLocal.P++;
                statsVisitante.Pts += 3;
            } else {
                statsLocal.E++; statsVisitante.E++;
                statsLocal.Pts += 1; statsVisitante.Pts += 1;
            }
        }

        function checkCampeonLiga() {
            const equiposOrdenados = [...appData.liga.equipos].sort((a, b) => {
                const statsA = appData.liga.tabla[a];
                const statsB = appData.liga.tabla[b];
                if (statsB.Pts !== statsA.Pts) return statsB.Pts - statsA.Pts;
                return statsB.DG - statsA.DG;
            });

            const partidosJugados = Object.keys(appData.liga.partidosJugados).length;
            const partidosTotales = (appData.liga.equipos.length * (appData.liga.equipos.length - 1)) / 2;
            
            if (partidosJugados >= partidosTotales * 0.8) {
                const nuevoCampeon = equiposOrdenados[0];
                if (nuevoCampeon !== appData.liga.campeon) {
                    appData.liga.campeon = nuevoCampeon;
                    // Mostrar popup de confirmaci√≥n para Hall de la Fama
                    if (appData.userRole === 'pato') {
                        setTimeout(() => {
                            if (confirm(`¬øGuardar a ${nuevoCampeon} como campe√≥n de la Liga en el Hall de la Fama (Temporada 6)?`)) {
                                appData.hallFama.temporadas[6].liga = nuevoCampeon;
                                saveData();
                            }
                        }, 500);
                    }
                }
            }
        }

        // COPA PAKISTANI - TOMA LOS 16 PRIMEROS DE LA LIGA
        function getTop16Liga() {
            const equiposOrdenados = [...appData.liga.equipos].sort((a, b) => {
                const statsA = appData.liga.tabla[a] || { Pts: 0, DG: 0, GF: 0 };
                const statsB = appData.liga.tabla[b] || { Pts: 0, DG: 0, GF: 0 };
                
                if (statsB.Pts !== statsA.Pts) return statsB.Pts - statsA.Pts;
                if (statsB.DG !== statsA.DG) return statsB.DG - statsA.DG;
                return statsB.GF - statsA.GF;
            });
            
            return equiposOrdenados.slice(0, 16);
        }

        function initializePakistani() {
            const top16 = getTop16Liga();
            top16.sort(() => Math.random() - 0.5);
            
            appData.pakistani.fases.octavos = [];
            for (let i = 0; i < 16; i += 2) {
                appData.pakistani.fases.octavos.push({
                    local: top16[i],
                    visitante: top16[i + 1],
                    jugado: false,
                    resultado: null,
                    ganador: null
                });
            }
        }

        function showPakistani() {
            const content = document.getElementById('tournamentContent');
            content.innerHTML = `
                <button class="back-btn" onclick="hideTournament()">üîô Volver al Men√∫</button>
                <h2>üèÖ COPA PAKISTANI</h2>
                
                ${appData.pakistani.campeon ? `
                    <div class="champion-badge">
                        üèÜ CAMPE√ìN: ${appData.pakistani.campeon} üèÜ
                    </div>
                ` : ''}
                
                <div style="text-align: center; margin: 20px 0;">
                    <p style="color: #666; font-size: 1.1em;">
                        Sistema de eliminaci√≥n directa - 16 equipos (top de la liga)
                    </p>
                    <p><small>Clasifican los 16 primeros de la tabla de la liga</small></p>
                    ${appData.userRole === 'pato' ? `
                        <button class="btn btn-generate" onclick="iniciarPakistani()" style="margin: 10px;">
                            Reiniciar Copa
                        </button>
                    ` : ''}
                </div>
                
                <div class="fases-container">
                    ${generarVistaFase('octavos', 'Octavos de Final')}
                    ${appData.pakistani.fases.octavos.every(p => p.jugado) ? generarVistaFase('cuartos', 'Cuartos de Final') : ''}
                    ${appData.pakistani.fases.cuartos.every(p => p.jugado) ? generarVistaFase('semis', 'Semifinales') : ''}
                    ${appData.pakistani.fases.semis.every(p => p.jugado) ? generarVistaFase('final', 'Final') : ''}
                </div>

                ${appData.userRole === 'pato' && appData.pakistani.fases.octavos.every(p => p.jugado) && appData.pakistani.fases.cuartos.length === 0 ? `
                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn btn-advance" onclick="avanzarFasePakistani('octavos')">
                            üöÄ Avanzar a Cuartos de Final
                        </button>
                    </div>
                ` : ''}

                ${appData.userRole === 'pato' && appData.pakistani.fases.cuartos.every(p => p.jugado) && appData.pakistani.fases.semis.length === 0 ? `
                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn btn-advance" onclick="avanzarFasePakistani('cuartos')">
                            üöÄ Avanzar a Semifinales
                        </button>
                    </div>
                ` : ''}

                ${appData.userRole === 'pato' && appData.pakistani.fases.semis.every(p => p.jugado) && appData.pakistani.fases.final.length === 0 ? `
                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn btn-advance" onclick="avanzarFasePakistani('semis')">
                            üöÄ Avanzar a Final
                        </button>
                    </div>
                ` : ''}
            `;
        }

        function generarVistaFase(fase, titulo) {
            const partidos = appData.pakistani.fases[fase];
            if (!partidos || partidos.length === 0) return '';

            let html = `<h3>${titulo}</h3>`;
            partidos.forEach((partido, index) => {
                html += `
                    <div class="match ${partido.jugado ? 'played' : ''}">
                        <div class="teams">
                            <strong>${partido.local}</strong>
                            <span class="vs">VS</span>
                            <strong>${partido.visitante}</strong>
                        </div>
                        ${partido.jugado ? `
                            <span class="result" style="color: #28a745;">
                                ${partido.resultado.local}-${partido.resultado.visitante}
                            </span>
                            <span style="color: #666;">‚Üí ${partido.ganador}</span>
                        ` : `
                            <button class="btn btn-generate" onclick="jugarPartidoPakistani('${fase}', ${index})">
                                ${appData.userRole === 'pato' ? 'Jugar' : 'Simular'}
                            </button>
                        `}
                    </div>
                `;
            });
            return html;
        }

        async function jugarPartidoPakistani(fase, index) {
            const partido = appData.pakistani.fases[fase][index];
            const resultado = generarResultadoAleatorio();
            
            if (appData.userRole === 'pato') {
                partido.jugado = true;
                partido.resultado = resultado;
                partido.ganador = resultado.local > resultado.visitante ? partido.local : partido.visitante;

                if (fase === 'final') {
                    const nuevoCampeon = partido.ganador;
                    appData.pakistani.campeon = nuevoCampeon;
                    // Mostrar popup de confirmaci√≥n para Hall de la Fama
                    setTimeout(() => {
                        if (confirm(`¬øGuardar a ${nuevoCampeon} como campe√≥n de la Copa Pakistani en el Hall de la Fama (Temporada 6)?`)) {
                            appData.hallFama.temporadas[6].pakistani = nuevoCampeon;
                            saveData();
                        }
                    }, 500);
                }

                await saveData();
                playGoalSound();
            } else {
                // Simulaci√≥n para femboy
                partido.resultado = resultado;
                partido.ganador = resultado.local > resultado.visitante ? partido.local : partido.visitante;
            }

            showPakistani();
        }

        async function avanzarFasePakistani(faseActual) {
            const partidos = appData.pakistani.fases[faseActual];
            const ganadores = partidos.map(p => p.ganador);
            
            let siguienteFase;
            if (faseActual === 'octavos') siguienteFase = 'cuartos';
            else if (faseActual === 'cuartos') siguienteFase = 'semis';
            else if (faseActual === 'semis') siguienteFase = 'final';
            
            if (siguienteFase === 'final') {
                appData.pakistani.fases.final = [{
                    local: ganadores[0],
                    visitante: ganadores[1],
                    jugado: false,
                    resultado: null,
                    ganador: null
                }];
            } else {
                appData.pakistani.fases[siguienteFase] = [];
                for (let i = 0; i < ganadores.length; i += 2) {
                    appData.pakistani.fases[siguienteFase].push({
                        local: ganadores[i],
                        visitante: ganadores[i+1],
                        jugado: false,
                        resultado: null,
                        ganador: null
                    });
                }
            }
            
            await saveData();
            showPakistani();
        }

        function iniciarPakistani() {
            if (confirm('¬øReiniciar la Copa Pakistani?')) {
                appData.pakistani.fases = { octavos: [], cuartos: [], semis: [], final: [] };
                appData.pakistani.campeon = null;
                initializePakistani();
                saveData();
                showPakistani();
            }
        }

        // COPA ETS - TOMA LOS 8 PRIMEROS DE LA LIGA
        function getTop8Liga() {
            const equiposOrdenados = [...appData.liga.equipos].sort((a, b) => {
                const statsA = appData.liga.tabla[a] || { Pts: 0, DG: 0, GF: 0 };
                const statsB = appData.liga.tabla[b] || { Pts: 0, DG: 0, GF: 0 };
                
                if (statsB.Pts !== statsA.Pts) return statsB.Pts - statsA.Pts;
                if (statsB.DG !== statsA.DG) return statsB.DG - statsA.DG;
                return statsB.GF - statsA.GF;
            });
            
            return equiposOrdenados.slice(0, 8);
        }

        function initializeETS() {
            const top8 = getTop8Liga();
            top8.sort(() => Math.random() - 0.5);
            
            appData.ets.fases.cuartos = [];
            for (let i = 0; i < 8; i += 2) {
                appData.ets.fases.cuartos.push({
                    local: top8[i],
                    visitante: top8[i + 1],
                    ida: { jugado: false, resultado: null },
                    vuelta: { jugado: false, resultado: null },
                    ganador: null
                });
            }
        }

        function showETS() {
            const content = document.getElementById('tournamentContent');
            content.innerHTML = `
                <button class="back-btn" onclick="hideTournament()">üîô Volver al Men√∫</button>
                <h2>üåü COPA ETS - ${etsFaseActual.toUpperCase()} (${etsTipoPartido.toUpperCase()})</h2>
                
                ${appData.ets.campeon ? `
                    <div class="champion-badge">
                        üèÜ CAMPE√ìN: ${appData.ets.campeon} üèÜ
                    </div>
                ` : ''}
                
                <div style="text-align: center; margin: 20px 0;">
                    <p style="color: #666; font-size: 1.1em;">
                        Sistema de ida y vuelta - 8 equipos (top de la liga)
                    </p>
                    <p><small>Clasifican los 8 primeros de la tabla de la liga</small></p>
                    <div style="margin: 10px 0;">
                        <button class="btn ${etsTipoPartido === 'ida' ? 'btn-generate' : ''}" onclick="cambiarTipoPartidoETS('ida')">
                            Partidos de Ida
                        </button>
                        <button class="btn ${etsTipoPartido === 'vuelta' ? 'btn-generate' : ''}" onclick="cambiarTipoPartidoETS('vuelta')">
                            Partidos de Vuelta
                        </button>
                    </div>
                    ${appData.userRole === 'pato' ? `
                        <button class="btn btn-generate" onclick="iniciarETS()" style="margin: 10px;">
                            Reiniciar Copa
                        </button>
                    ` : ''}
                </div>
                
                <div class="fases-container">
                    ${generarVistaETS()}
                </div>

                ${appData.userRole === 'pato' && puedeAvanzarETS() ? `
                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn btn-advance" onclick="avanzarFaseETS()">
                            üöÄ Avanzar a ${getSiguienteFaseETS()}
                        </button>
                    </div>
                ` : ''}
            `;
        }

        function cambiarTipoPartidoETS(tipo) {
            etsTipoPartido = tipo;
            showETS();
        }

        function generarVistaETS() {
            const partidos = appData.ets.fases[etsFaseActual];
            if (!partidos || partidos.length === 0) return '<p>No hay partidos en esta fase.</p>';

            let html = `<h3>${etsFaseActual.charAt(0).toUpperCase() + etsFaseActual.slice(1)} de Final</h3>`;
            partidos.forEach((partido, index) => {
                const partidoJugado = etsTipoPartido === 'ida' ? partido.ida.jugado : partido.vuelta.jugado;
                const resultado = etsTipoPartido === 'ida' ? partido.ida.resultado : partido.vuelta.resultado;
                
                let infoGlobal = '';
                if (partido.ida.jugado && partido.vuelta.jugado) {
                    const globalLocal = partido.ida.resultado.local + partido.vuelta.resultado.visitante;
                    const globalVisitante = partido.ida.resultado.visitante + partido.vuelta.resultado.local;
                    infoGlobal = `<br><small>Global: ${globalLocal}-${globalVisitante} ‚Üí ${partido.ganador || 'Por definir'}</small>`;
                }

                html += `
                    <div class="match ${partidoJugado ? 'played' : ''}">
                        <div class="teams">
                            <strong>${partido.local}</strong>
                            <span class="vs">VS</span>
                            <strong>${partido.visitante}</strong>
                        </div>
                        ${partidoJugado ? `
                            <span class="result" style="color: #28a745;">
                                ${resultado.local}-${resultado.visitante}
                            </span>
                            ${infoGlobal}
                        ` : `
                            <button class="btn btn-generate" onclick="jugarPartidoETS(${index})">
                                ${appData.userRole === 'pato' ? 'Jugar ' + etsTipoPartido : 'Simular ' + etsTipoPartido}
                            </button>
                        `}
                    </div>
                `;
            });
            return html;
        }

        async function jugarPartidoETS(index) {
            const partido = appData.ets.fases[etsFaseActual][index];
            const resultado = generarResultadoAleatorio();
            
            if (appData.userRole === 'pato') {
                if (etsTipoPartido === 'ida') {
                    partido.ida.jugado = true;
                    partido.ida.resultado = resultado;
                } else {
                    partido.vuelta.jugado = true;
                    partido.vuelta.resultado = resultado;
                }

                // Calcular ganador si ambos partidos est√°n jugados
                if (partido.ida.jugado && partido.vuelta.jugado) {
                    const globalLocal = partido.ida.resultado.local + partido.vuelta.resultado.visitante;
                    const globalVisitante = partido.ida.resultado.visitante + partido.vuelta.resultado.local;
                    
                    if (globalLocal > globalVisitante) {
                        partido.ganador = partido.local;
                    } else if (globalVisitante > globalLocal) {
                        partido.ganador = partido.visitante;
                    } else {
                        // Empate - ganador por penales (random)
                        partido.ganador = Math.random() > 0.5 ? partido.local : partido.visitante;
                    }

                    if (etsFaseActual === 'final' && partido.ganador) {
                        const nuevoCampeon = partido.ganador;
                        appData.ets.campeon = nuevoCampeon;
                        // Mostrar popup de confirmaci√≥n para Hall de la Fama
                        setTimeout(() => {
                            if (confirm(`¬øGuardar a ${nuevoCampeon} como campe√≥n de la Copa ETS en el Hall de la Fama (Temporada 6)?`)) {
                                appData.hallFama.temporadas[6].ets = nuevoCampeon;
                                saveData();
                            }
                        }, 500);
                    }
                }

                await saveData();
                playGoalSound();
            } else {
                // Simulaci√≥n para femboy
                if (etsTipoPartido === 'ida') {
                    partido.ida.resultado = resultado;
                } else {
                    partido.vuelta.resultado = resultado;
                }
            }

            showETS();
        }

        function puedeAvanzarETS() {
            const partidos = appData.ets.fases[etsFaseActual];
            return partidos && partidos.every(p => p.ida.jugado && p.vuelta.jugado) && 
                   appData.ets.fases[getSiguienteFaseETS()].length === 0;
        }

        function getSiguienteFaseETS() {
            if (etsFaseActual === 'cuartos') return 'semis';
            if (etsFaseActual === 'semis') return 'final';
            return null;
        }

        async function avanzarFaseETS() {
            const partidos = appData.ets.fases[etsFaseActual];
            const ganadores = partidos.map(p => p.ganador);
            
            const siguienteFase = getSiguienteFaseETS();
            if (siguienteFase) {
                appData.ets.fases[siguienteFase] = [];
                for (let i = 0; i < ganadores.length; i += 2) {
                    appData.ets.fases[siguienteFase].push({
                        local: ganadores[i],
                        visitante: ganadores[i+1],
                        ida: { jugado: false, resultado: null },
                        vuelta: { jugado: false, resultado: null },
                        ganador: null
                    });
                }
                etsFaseActual = siguienteFase;
                etsTipoPartido = 'ida';
                await saveData();
            }
            showETS();
        }

        function iniciarETS() {
            if (confirm('¬øReiniciar la Copa ETS?')) {
                appData.ets.fases = { cuartos: [], semis: [], final: [] };
                appData.ets.campeon = null;
                etsFaseActual = 'cuartos';
                etsTipoPartido = 'ida';
                initializeETS();
                saveData();
                showETS();
            }
        }

        // SUPERCOPA - PERMITE SIMULAR SIN TENER CAMPECONES
        function showSupercopa() {
            const campeonLiga = appData.liga.campeon || "Por definir";
            const campeonPakistani = appData.pakistani.campeon || "Por definir";
            const campeonETS = appData.ets.campeon || "Por definir";
            
            const content = document.getElementById('tournamentContent');
            content.innerHTML = `
                <button class="back-btn" onclick="hideTournament()">üîô Volver al Men√∫</button>
                <h2>üî• SUPERCOPA</h2>
                
                ${appData.supercopa.campeon ? `
                    <div class="champion-badge">
                        üèÜ CAMPE√ìN: ${appData.supercopa.campeon} üèÜ
                    </div>
                ` : ''}
                
                <div style="text-align: center; margin: 30px 0;">
                    <div style="margin: 15px 0;">
                        <p><strong>Campe√≥n de Liga:</strong> ${campeonLiga}</p>
                        <p><strong>Campe√≥n de Pakistani:</strong> ${campeonPakistani}</p>
                        ${campeonETS !== "Por definir" ? `<p><strong>Campe√≥n de ETS:</strong> ${campeonETS}</p>` : ''}
                    </div>

                    <div class="match" style="max-width: 400px; margin: 20px auto;">
                        <div class="teams">
                            <strong>${campeonLiga}</strong>
                            <span class="vs">VS</span>
                            <strong>${campeonPakistani}</strong>
                        </div>
                        ${appData.supercopa.partido ? `
                            <span class="result" style="color: #28a745;">
                                ${appData.supercopa.partido.local}-${appData.supercopa.partido.visitante}
                            </span>
                            ${appData.supercopa.campeon ? `<div style="margin-top: 10px; color: #666;">üèÜ ${appData.supercopa.campeon}</div>` : ''}
                        ` : `
                            <button class="btn btn-generate" onclick="jugarSupercopa()">
                                ${appData.userRole === 'pato' ? 'Jugar Partido' : 'Simular Partido'}
                            </button>
                        `}
                    </div>
                </div>
            `;
        }

        async function jugarSupercopa() {
            const resultado = generarResultadoAleatorio();
            const campeonLiga = appData.liga.campeon || "Campe√≥n de Liga";
            const campeonPakistani = appData.pakistani.campeon || "Campe√≥n de Pakistani";
            
            if (appData.userRole === 'pato') {
                appData.supercopa.partido = resultado;
                appData.supercopa.campeon = resultado.local > resultado.visitante ? campeonLiga : campeonPakistani;
                
                // Mostrar popup de confirmaci√≥n para Hall de la Fama
                setTimeout(() => {
                    if (confirm(`¬øGuardar a ${appData.supercopa.campeon} como campe√≥n de la Supercopa en el Hall de la Fama (Temporada 6)?`)) {
                        appData.hallFama.temporadas[6].supercopa = appData.supercopa.campeon;
                        saveData();
                    }
                }, 500);

                await saveData();
                playGoalSound();
            } else {
                // Simulaci√≥n para femboy
                appData.simulaciones.supercopa = {
                    partido: resultado,
                    campeon: resultado.local > resultado.visitante ? campeonLiga : campeonPakistani
                };
            }

            showSupercopa();
        }

        // HALL DE LA FAMA
        function showHallFama() {
            const content = document.getElementById('tournamentContent');
            content.innerHTML = `
                <button class="back-btn" onclick="hideTournament()">üîô Volver al Men√∫</button>
                <h2>üèõÔ∏è HALL DE LA FAMA</h2>
                
                <div class="hall-fama-container">
                    <div class="temporada-selector" id="temporadaSelector"></div>
                    <div id="campeonesTemporada"></div>
                </div>
            `;

            generarSelectorTemporadas();
            mostrarCampeonesTemporada(temporadaActualHallFama);
        }

        function generarSelectorTemporadas() {
            const selector = document.getElementById('temporadaSelector');
            let html = '';
            
            for (let i = 1; i <= 6; i++) {
                html += `
                    <button class="temporada-btn ${i === temporadaActualHallFama ? 'active' : ''}" 
                            onclick="cambiarTemporadaHallFama(${i})">
                        Temporada ${i}
                    </button>
                `;
            }
            
            selector.innerHTML = html;
        }

        function cambiarTemporadaHallFama(temporada) {
            temporadaActualHallFama = temporada;
            generarSelectorTemporadas();
            mostrarCampeonesTemporada(temporada);
        }

        function mostrarCampeonesTemporada(temporada) {
            const container = document.getElementById('campeonesTemporada');
            const campeones = appData.hallFama.temporadas[temporada];
            
            let html = `
                <h3 style="text-align: center; margin-bottom: 20px; color: #333;">
                    Campeones - Temporada ${temporada}
                </h3>
                <div class="campeones-grid">
            `;
            
            if (campeones.liga) {
                html += `
                    <div class="campeon-card liga">
                        <div class="campeon-titulo">üèÜ LIGA</div>
                        <div class="campeon-equipo">${campeones.liga}</div>
                    </div>
                `;
            }
            
            if (campeones.pakistani) {
                html += `
                    <div class="campeon-card pakistani">
                        <div class="campeon-titulo">üèÖ COPA PAKISTANI</div>
                        <div class="campeon-equipo">${campeones.pakistani}</div>
                    </div>
                `;
            }
            
            if (campeones.ets && temporada >= 5) {
                html += `
                    <div class="campeon-card ets">
                        <div class="campeon-titulo">üåü COPA ETS</div>
                        <div class="campeon-equipo">${campeones.ets}</div>
                    </div>
                `;
            }
            
            if (campeones.supercopa) {
                html += `
                    <div class="campeon-card supercopa">
                        <div class="campeon-titulo">üî• SUPERCOPA</div>
                        <div class="campeon-equipo">${campeones.supercopa}</div>
                    </div>
                `;
            }
            
            html += `</div>`;
            
            if (temporada === 6 && Object.values(campeones).every(c => c === null)) {
                html += `
                    <div style="text-align: center; color: #666; margin-top: 20px;">
                        ‚è≥ Temporada en curso...
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // REINICIAR TODOS LOS TORNEOS
        async function resetAllTournaments() {
            if (confirm('¬øEST√ÅS SEGURO DE QUE QUER√âS REINICIAR TODOS LOS TORNEOS?\n\nSe borrar√°n TODOS los resultados y se empezar√° desde cero.')) {
                appData.liga.tabla = {};
                appData.liga.partidosJugados = {};
                appData.liga.fixture = [];
                appData.liga.campeon = null;
                appData.liga.historialPosiciones = [];
                
                appData.pakistani.fases = { octavos: [], cuartos: [], semis: [], final: [] };
                appData.pakistani.campeon = null;
                
                appData.ets.fases = { cuartos: [], semis: [], final: [] };
                appData.ets.campeon = null;
                etsFaseActual = 'cuartos';
                etsTipoPartido = 'ida';
                
                appData.supercopa.partido = null;
                appData.supercopa.campeon = null;
                
                appData.hallFama.temporadas[6] = { liga: null, pakistani: null, ets: null, supercopa: null };
                
                appData.simulaciones = {
                    liga: {},
                    pakistani: {},
                    ets: {},
                    supercopa: {}
                };

                initializeData();
                alert('‚úÖ Todos los torneos han sido reiniciados');
                showLiga();
            }
        }

        // Inicializar la aplicaci√≥n
        window.onload = function() {
            console.log('üèÜ COPA PIST√ìN - Edici√≥n Definitiva üèÜ');
        };
    </script>
</body>
</html>
